{"ast":null,"code":"import _objectSpread from\"D:/CtyDinhDuy/DinhDuyCTY/FE/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import React,{useEffect,useState}from'react';import ConfirmDeleteModal from'../components/ConfirmDeleteModal';import ImageEditModal from'../components/ImageEditModal';import{jsx as _jsx,jsxs as _jsxs}from\"react/jsx-runtime\";const API='http://localhost:5000/api/gallery';const UPLOAD_API='http://localhost:5000/api/gallery/upload';const AdminGalleryManager=()=>{const[images,setImages]=useState([]);const[form,setForm]=useState({img:'',caption:''});const[file,setFile]=useState(null);const[editId,setEditId]=useState(null);const[deleteId,setDeleteId]=useState(null);const[showEditModal,setShowEditModal]=useState(false);const fetchImages=async()=>{const res=await fetch(API);const data=await res.json();setImages(data);};useEffect(()=>{fetchImages();},[]);const handleChange=e=>{setForm(_objectSpread(_objectSpread({},form),{},{[e.target.name]:e.target.value}));};const handleFileChange=e=>{setFile(e.target.files[0]);};const handleSubmit=async e=>{e.preventDefault();let imgUrl=form.img;if(file){const data=new FormData();data.append('image',file);const res=await fetch(UPLOAD_API,{method:'POST',body:data});const result=await res.json();imgUrl=result.url;}if(editId){await fetch(\"\".concat(API,\"/\").concat(editId),{method:'PUT',headers:{'Content-Type':'application/json'},body:JSON.stringify({img:imgUrl,caption:form.caption})});}else{await fetch(API,{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({img:imgUrl,caption:form.caption})});}setForm({img:'',caption:''});setFile(null);setEditId(null);setShowEditModal(false);fetchImages();};const handleDelete=async()=>{if(!deleteId)return;await fetch(\"\".concat(API,\"/\").concat(deleteId),{method:'DELETE'});setDeleteId(null);fetchImages();};return/*#__PURE__*/_jsxs(\"div\",{className:\"mb-8\",children:[/*#__PURE__*/_jsx(\"h2\",{className:\"text-xl font-bold mb-4\",children:\"Qu\\u1EA3n l\\xFD H\\xECnh \\u1EA3nh\"}),/*#__PURE__*/_jsx(\"button\",{onClick:()=>{setForm({img:'',caption:''});setEditId(null);setShowEditModal(true);},className:\"bg-blue-600 text-white px-4 py-2 rounded mb-4\",children:\"Th\\xEAm \\u1EA3nh\"}),/*#__PURE__*/_jsx(ImageEditModal,{open:showEditModal,onClose:()=>setShowEditModal(false),onSubmit:handleSubmit,form:form,onChange:handleChange,onFileChange:handleFileChange,isEdit:!!editId,title:editId?'Sửa ảnh':'Thêm ảnh'}),/*#__PURE__*/_jsx(\"div\",{className:\"overflow-x-auto\",children:/*#__PURE__*/_jsxs(\"table\",{className:\"min-w-full bg-white border rounded shadow\",children:[/*#__PURE__*/_jsx(\"thead\",{children:/*#__PURE__*/_jsxs(\"tr\",{className:\"bg-blue-100\",children:[/*#__PURE__*/_jsx(\"th\",{className:\"py-2 px-3 border text-center w-16\",children:\"STT\"}),/*#__PURE__*/_jsx(\"th\",{className:\"py-2 px-3 border text-center w-64\",children:\"\\u1EA2nh\"}),/*#__PURE__*/_jsx(\"th\",{className:\"py-2 px-3 border text-left\",children:\"Ch\\xFA th\\xEDch\"}),/*#__PURE__*/_jsx(\"th\",{className:\"py-2 px-3 border text-center w-32\",children:\"H\\xE0nh \\u0111\\u1ED9ng\"})]})}),/*#__PURE__*/_jsx(\"tbody\",{children:images.map((img,idx)=>/*#__PURE__*/_jsxs(\"tr\",{className:\"border-b hover:bg-blue-50\",children:[/*#__PURE__*/_jsx(\"td\",{className:\"py-2 px-3 border text-center font-semibold\",children:idx+1}),/*#__PURE__*/_jsx(\"td\",{className:\"py-2 px-3 border text-center\",children:/*#__PURE__*/_jsx(\"img\",{src:img.img,alt:\"gallery\",className:\"mx-auto w-64 h-24 object-cover rounded shadow\"})}),/*#__PURE__*/_jsx(\"td\",{className:\"py-2 px-3 border align-middle\",children:img.caption}),/*#__PURE__*/_jsx(\"td\",{className:\"py-2 px-3 border text-center\",children:/*#__PURE__*/_jsx(\"button\",{onClick:()=>setDeleteId(img._id),className:\"bg-red-500 text-white px-3 py-1 rounded shadow hover:bg-red-600\",children:\"Xo\\xE1\"})})]},img._id||img.id||idx))})]})}),/*#__PURE__*/_jsx(ConfirmDeleteModal,{open:!!deleteId,onClose:()=>setDeleteId(null),onConfirm:handleDelete,text:\"B\\u1EA1n c\\xF3 ch\\u1EAFc ch\\u1EAFn mu\\u1ED1n xo\\xE1 h\\xECnh \\u1EA3nh n\\xE0y kh\\xF4ng?\"})]});};export default AdminGalleryManager;","map":{"version":3,"names":["React","useEffect","useState","ConfirmDeleteModal","ImageEditModal","jsx","_jsx","jsxs","_jsxs","API","UPLOAD_API","AdminGalleryManager","images","setImages","form","setForm","img","caption","file","setFile","editId","setEditId","deleteId","setDeleteId","showEditModal","setShowEditModal","fetchImages","res","fetch","data","json","handleChange","e","_objectSpread","target","name","value","handleFileChange","files","handleSubmit","preventDefault","imgUrl","FormData","append","method","body","result","url","concat","headers","JSON","stringify","handleDelete","className","children","onClick","open","onClose","onSubmit","onChange","onFileChange","isEdit","title","map","idx","src","alt","_id","id","onConfirm","text"],"sources":["D:/CtyDinhDuy/DinhDuyCTY/FE/src/pages/AdminGalleryManager.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\r\nimport ConfirmDeleteModal from '../components/ConfirmDeleteModal';\r\nimport ImageEditModal from '../components/ImageEditModal';\r\n\r\nconst API = 'http://localhost:5000/api/gallery';\r\nconst UPLOAD_API = 'http://localhost:5000/api/gallery/upload';\r\n\r\nconst AdminGalleryManager = () => {\r\n  const [images, setImages] = useState([]);\r\n  const [form, setForm] = useState({ img: '', caption: '' });\r\n  const [file, setFile] = useState(null);\r\n  const [editId, setEditId] = useState(null);\r\n  const [deleteId, setDeleteId] = useState(null);\r\n  const [showEditModal, setShowEditModal] = useState(false);\r\n\r\n  const fetchImages = async () => {\r\n    const res = await fetch(API);\r\n    const data = await res.json();\r\n    setImages(data);\r\n  };\r\n\r\n  useEffect(() => { fetchImages(); }, []);\r\n\r\n  const handleChange = e => {\r\n    setForm({ ...form, [e.target.name]: e.target.value });\r\n  };\r\n\r\n  const handleFileChange = e => {\r\n    setFile(e.target.files[0]);\r\n  };\r\n\r\n  const handleSubmit = async e => {\r\n    e.preventDefault();\r\n    let imgUrl = form.img;\r\n    if (file) {\r\n      const data = new FormData();\r\n      data.append('image', file);\r\n      const res = await fetch(UPLOAD_API, {\r\n        method: 'POST',\r\n        body: data\r\n      });\r\n      const result = await res.json();\r\n      imgUrl = result.url;\r\n    }\r\n    if (editId) {\r\n      await fetch(`${API}/${editId}`, {\r\n        method: 'PUT',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ img: imgUrl, caption: form.caption })\r\n      });\r\n    } else {\r\n      await fetch(API, {\r\n        method: 'POST',\r\n        headers: { 'Content-Type': 'application/json' },\r\n        body: JSON.stringify({ img: imgUrl, caption: form.caption })\r\n      });\r\n    }\r\n    setForm({ img: '', caption: '' });\r\n    setFile(null);\r\n    setEditId(null);\r\n    setShowEditModal(false);\r\n    fetchImages();\r\n  };\r\n\r\n  const handleDelete = async () => {\r\n    if (!deleteId) return;\r\n    await fetch(`${API}/${deleteId}`, { method: 'DELETE' });\r\n    setDeleteId(null);\r\n    fetchImages();\r\n  };\r\n\r\n  return (\r\n    <div className=\"mb-8\">\r\n      <h2 className=\"text-xl font-bold mb-4\">Quản lý Hình ảnh</h2>\r\n      {/* Thay thế form nhập bằng nút Thêm và modal */}\r\n      <button onClick={() => { setForm({ img: '', caption: '' }); setEditId(null); setShowEditModal(true); }} className=\"bg-blue-600 text-white px-4 py-2 rounded mb-4\">Thêm ảnh</button>\r\n      {/* Modal thêm/sửa ảnh */}\r\n      <ImageEditModal\r\n        open={showEditModal}\r\n        onClose={() => setShowEditModal(false)}\r\n        onSubmit={handleSubmit}\r\n        form={form}\r\n        onChange={handleChange}\r\n        onFileChange={handleFileChange}\r\n        isEdit={!!editId}\r\n        title={editId ? 'Sửa ảnh' : 'Thêm ảnh'}\r\n      />\r\n      <div className=\"overflow-x-auto\">\r\n        <table className=\"min-w-full bg-white border rounded shadow\">\r\n          <thead>\r\n            <tr className=\"bg-blue-100\">\r\n              <th className=\"py-2 px-3 border text-center w-16\">STT</th>\r\n              <th className=\"py-2 px-3 border text-center w-64\">Ảnh</th>\r\n              <th className=\"py-2 px-3 border text-left\">Chú thích</th>\r\n              <th className=\"py-2 px-3 border text-center w-32\">Hành động</th>\r\n            </tr>\r\n          </thead>\r\n          <tbody>\r\n            {images.map((img, idx) => (\r\n              <tr key={img._id || img.id || idx} className=\"border-b hover:bg-blue-50\">\r\n                <td className=\"py-2 px-3 border text-center font-semibold\">{idx + 1}</td>\r\n                <td className=\"py-2 px-3 border text-center\"><img src={img.img} alt=\"gallery\" className=\"mx-auto w-64 h-24 object-cover rounded shadow\" /></td>\r\n                <td className=\"py-2 px-3 border align-middle\">{img.caption}</td>\r\n                <td className=\"py-2 px-3 border text-center\">\r\n                  <button onClick={() => setDeleteId(img._id)} className=\"bg-red-500 text-white px-3 py-1 rounded shadow hover:bg-red-600\">Xoá</button>\r\n                </td>\r\n              </tr>\r\n            ))}\r\n          </tbody>\r\n        </table>\r\n      </div>\r\n      <ConfirmDeleteModal\r\n        open={!!deleteId}\r\n        onClose={() => setDeleteId(null)}\r\n        onConfirm={handleDelete}\r\n        text=\"Bạn có chắc chắn muốn xoá hình ảnh này không?\"\r\n      />\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AdminGalleryManager;\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}